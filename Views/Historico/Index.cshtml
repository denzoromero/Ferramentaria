@model FerramentariaTest.Models.CombinedHistoricoModel
@using System.Web
@{
    ViewData["Title"] = "Historico";
    //Layout = "~/Views/Shared/_Layout.cshtml";
}

<h4>Historico</h4>
<br />


<div class="modal fade" id="ListOfMessages" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">

            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel"> Mensagem </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <table class="table table-sm align-left" id="myTable5">
                    <tbody>
                        @if (ViewBag.Messages != null)
                        {
                            @foreach (var item in ViewBag.Messages)
                            {
                                <tr>
                                    <td>
                                        <span><b>Postado Por:</b></span>@item.Username
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span><b>Texto:</b></span> @item.Mensagem
                                        @if (item.Fixar != 1)
                                        {
                                            <a asp-action="DeleteMessage" asp-route-id="@item.Id">Apagar</a>
                                        }
                                        else
                                        {
                                            @*  if (item.IdUsuario_Adicionou == item.LoggedUserId)
                                {
                                <a asp-action="DeleteMessage" asp-route-id="@item.Id">Apagar</a>
                                } *@

                                            if (item.allowdelete == true)
                                            {
                                                <a asp-action="DeleteMessage" asp-route-id="@item.Id">Apagar</a>
                                            }
                                        }
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>

                </table>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="ListOfUsers" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">

            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel"> List of Employees </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <table class="table table-sm align-left" id="myTable4">
                    <thead>
                        <tr>
                            <th>
                                Chapa
                            </th>
                            <th>
                                Nome
                            </th>
                            <th>
                                CodSituacao
                            </th>
                            <th>
                                Secao
                            </th>
                            <th>

                            </th>
                        </tr>
                    </thead>

                    <tbody>
                        @if (ViewBag.ListOfEmployees != null)
                        {
                            @foreach (var item in ViewBag.ListOfEmployees)
                            {
                                <tr>
                                    <td>
                                        @item.Chapa
                                    </td>
                                    <td>
                                        @item.Nome
                                    </td>
                                    <td>
                                        @item.CodSituacao
                                    </td>
                                    <td>
                                        @item.Secao
                                    </td>
                                    <td>
                                        <a asp-action="SelectedUser" asp-route-chapa="@item.Chapa">Select</a>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>

                </table>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                @*    <button type="submit" class="btn btn-primary position-relative">
                <img src="~/img/plus-lg.svg" alt="Plus Icon"> Confirmar Extravio
                </button>*@
            </div>

        </div>
    </div>
</div>

@*modal for obs*@
<div class="modal fade" id="obsModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">

            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel"> Observação </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                @if (ViewBag.Observacao != null)
                {
                    <p>@ViewBag.Codigo</p>
                    <p>@ViewBag.Observacao</p>
                }
                else
                {

                }
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

@*modal for Liberador*@
<div class="modal fade" id="LiberadorModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">

            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel"> Liberador </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="row">
                    <div class="col-md-15">
                        <div class="d-flex align-items-start">
                            @if (ViewData["Base64ImageBalc"] == null)
                            {
                                <img src="~/img/image-not-available.jpg" class="rounded" alt="..." height="160px" width="130px" />
                            }
                            else
                            {
                                <img src="data:image/jpeg;base64,@ViewData["Base64ImageBalc"]" class="rounded" alt="..." height="160px" width="130px" />
                            }
                            <div class="ms-2">

                                @if (ViewBag.LiberadorChapa != null)
                                {
                                    <div>
                                        <label for="colFormLabelSm">Chapa:</label>
                                        <span> @ViewBag.LiberadorChapa </span>
                                    </div>
                                    <div class="mt-1">
                                        <label for="colFormLabelSm"> Nome:</label>
                                        <span> @ViewBag.LiberadorNome </span>
                                    </div>
                                }

                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

@*modal for Balconista Emp*@
<div class="modal fade" id="BalconistaEmpModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">

            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel"> Balconista </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="row">
                    <div class="col-md-15">
                        <div class="d-flex align-items-start">
                            @if (ViewData["Base64ImageBalc"] == null)
                            {
                                <img src="~/img/image-not-available.jpg" class="rounded" alt="..." height="160px" width="130px" />
                            }
                            else
                            {
                                <img src="data:image/jpeg;base64,@ViewData["Base64ImageBalc"]" class="rounded" alt="..." height="160px" width="130px" />
                            }
                            <div class="ms-2">

                                @if (ViewBag.BalconistaEmpChapa != null)
                                {
                                    <div>
                                        <label for="colFormLabelSm">Chapa:</label>
                                        <span> @ViewBag.BalconistaEmpChapa </span>
                                    </div>
                                    <div class="mt-1">
                                        <label for="colFormLabelSm"> Nome:</label>
                                        <span> @ViewBag.BalconistaEmpNome </span>
                                    </div>
                                }

                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

@*modal for Balconista Dev*@
<div class="modal fade" id="BalconistaDevModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">

            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel"> Balconista </h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="row">
                    <div class="col-md-15">
                        <div class="d-flex align-items-start">
                            @if (ViewData["Base64ImageBalc"] == null)
                            {
                                <img src="~/img/image-not-available.jpg" class="rounded" alt="..." height="160px" width="130px" />
                            }
                            else
                            {
                                <img src="data:image/jpeg;base64,@ViewData["Base64ImageBalc"]" class="rounded" alt="..." height="160px" width="130px" />
                            }
                            <div class="ms-2">

                                @if (ViewBag.BalconistaDevChapa != null)
                                {
                                    <div>
                                        <label for="colFormLabelSm">Chapa:</label>
                                        <span> @ViewBag.BalconistaDevChapa </span>
                                    </div>
                                    <div class="mt-1">
                                        <label for="colFormLabelSm"> Nome:</label>
                                        <span> @ViewBag.BalconistaDevNome </span>
                                    </div>
                                }

                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

@*modal for upload*@
<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel"><img src="~/img/upload_modal.svg" /> Upload</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                @if (ViewBag.ErrorUpload != null)
                {
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <img src="~/img/exclamation-triangle-fill.svg" /> @ViewBag.ErrorUpload
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }
                <form method="post" enctype="multipart/form-data" action="UploadAction">
                    <div class="input-group mb-3">
                        <input type="file" name="file" class="form-control" id="inputGroupFile02">

                        @if (ViewBag.IdHolder != null)
                        {
                            <input type="text" name="HistoricoAlocacaoId" class="form-control" value="@ViewBag.IdHolder" style="display: none;">
                            <input type="text" name="IdProdutoAlocado" class="form-control" value="@ViewBag.IdProdutoAlocado" style="display: none;">
                            <input type="text" name="YearDevolucao" class="form-control" value="@ViewBag.YearDevolucao" style="display: none;">
                        }

                        @*<input type="text" id="inputIdProduto" name="ProdutoAloId" class="form-control" style="display: none;">*@
                        @* <label class="input-group-text" for="inputGroupFile02">Choose file</label>*@
                    </div>
                    <button type="submit" class="btn btn-primary">Upload</button>
                </form>
                <p><b> Listagem de Fichas Relacionadas ao Emprestimo </b></p>
                <table class="table table-sm align-left" id="myTable2">
                    <thead>
                        <tr>
                            <th>
                                Ficha
                            </th>
                            <th>
                                Resposável pelo Upload
                            </th>
                            <th>
                                Download
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.AlocadoImages != null)
                        {
                            @foreach (var image in ViewBag.AlocadoImages)
                            {
                                <tr>

                                    <td>
                                        @if (image.ImageData != null)
                                        {
                                            <a href="data:image/jpeg;base64,@Convert.ToBase64String(image.ImageData)" data-lightbox="image-group" data-title="@image.ArquivoNome"> @image.ArquivoNome  </a>
                                        }
                                        else
                                        {
                                            <a href="http://@image.ArquivoNome" target="_blank">@image.ArquivoNome</a>
                                        }

                                      @*  @image.ArquivoNome*@
                                    </td>


                                    <td>
                                        @image.Solicitante_Chapa
                                    </td>

                                    <td>
                                      @*  <a href="data:image/jpeg;base64,@Convert.ToBase64String(image.ImageData)" download="@image.ArquivoNome">
                                            <img src="~/img/upload_modal.svg" />
                                        </a>*@
                                    </td>

                                </tr>
                            }
                        }
                    </tbody>
                </table>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<form asp-action="SearchDev" method="get">
<div class="row mb-2">
    <label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm"> Matricula / Nome: </label>
    <div class="col-sm-2">
        <input name="IdFuncionario" class="form-control form-control-sm" id="colFormLabelSm">
    </div>
    <div class="col-sm-4">
            <button type="submit" class="btn btn-info loadingButton" style="color: white;">
            <img src="~/img/search.svg" />
        </button>
    </div>
</div>
</form>

@*<form asp-action="Index" method="post" id="SearchDevolucao">*@
<form asp-action="SearchHistoricoNew" method="post" id="SearchDevolucao">
<div class="row">

    <div class="col-md-5">

        <div id="Solicitante">
            <div class="row">
                <div class="col-md-8">

                    <div class="d-flex align-items-start">
                        @if (Model != null && Model.UserViewModel.Image != null)
                        {
                                <img src="data:image/jpeg;base64,@Convert.ToBase64String(Model.UserViewModel.Image)" class="rounded" alt="..." height="160px" width="130px" />
                        }
                        else
                        {
                                <img src="~/img/image-not-available.jpg" class="rounded" alt="..." height="160px" width="130px" />
                        }

                        <div class="ms-2">

                            @if (Model?.UserViewModel == null)
                            {
                                <div>
                                    <label for="colFormLabelSm">Chapa:</label>
                                    <span>  </span>
                                    @*         <input name="chapa" type="hidden" value="@Model.Chapa" />*@
                                </div>
                                <div class="mt-1">
                                    <label for="colFormLabelSm"> Nome:</label>
                                    <span>  </span>
                                </div>

                                <div class="mt-1">
                                    <!-- Add margin-top for spacing -->
                                    <label for="colFormLabelSm"> Cod Situação:</label>
                                    <span>  </span>
                                </div>

                                <div class="mt-1">
                                    <!-- Add margin-top for spacing -->
                                    <label for="colFormLabelSm"> Empressa:</label>
                                    <span>  </span>
                                </div>

                                <div class="mt-1">
                                    <!-- Add margin-top for spacing -->
                                    <label for="colFormLabelSm"> Função:</label>
                                    <span> </span>
                                </div>

                                <div class="mt-1">
                                    <!-- Add margin-top for spacing -->
                                    <label for="colFormLabelSm"> Seção:</label>
                                    <span> </span>
                                </div>

                            }
                            else
                            {
                                <input name="DateAdmission" type="hidden" value="@Model.UserViewModel.DataAdmissao" />
                                <div>
                                    <label for="colFormLabelSm">Chapa:</label>
                                        <span> @Model.UserViewModel.Chapa </span>
                                        <input name="chapaFuncionario" type="hidden" value="@Model.UserViewModel.Chapa" />
                                </div>
                                <div class="mt-1 d-flex">
                                    <label for="colFormLabelSm"> Nome: </label>
                                        <span style="white-space: nowrap;"> &nbsp; @Model.UserViewModel.Nome </span>
                                        <input name="nomeFuncionario" type="hidden" value="@Model.UserViewModel.Nome" />
                                </div>

                                @if (Model.UserViewModel.CodSituacao != "D")
                                {
                                    <div class="mt-1">
                                        <!-- Add margin-top for spacing -->
                                        <label for="colFormLabelSm"> Cod Situação:</label>
                                            <span> @Model.UserViewModel.CodSituacao </span>
                                    </div>
                                }
                                else
                                {
                                    <div class="mt-1">
                                        <!-- Add margin-top for spacing -->
                                        <label for="colFormLabelSm"> Cod Situação:</label>
                                            <span> <font color="red"> @Model.UserViewModel.CodSituacao </font> </span>
                                            <input name="CodSituacaoFuncionario" type="hidden" value="@Model.UserViewModel.CodSituacao" />
                                    </div>
                                    <div class="mt-1">
                                        <!-- Add margin-top for spacing -->
                                        <label for="colFormLabelSm"> Date Demissão:</label>
                                            <span> <font color="red"> @(((DateTime)Model.UserViewModel.DataDemissao).ToString("dd/MM/yyyy")) </font> </span>
                                    </div>

                                }

                                    <input name="coligadaFuncionario" type="hidden" value="@Model.UserViewModel.CodColigada" />


                                <div class="mt-1">
                                    <!-- Add margin-top for spacing -->
                                    <label for="colFormLabelSm"> Empressa:</label>
                                    @if (Model.UserViewModel.CodColigada == 2)
                                    {
                                        <span> Company </span>
                                    }
                                    else
                                    {
                                        <span>  </span>
                                    }
                                </div>

                                <div class="mt-1">
                                    <!-- Add margin-top for spacing -->
                                    <label for="colFormLabelSm"> Função:</label>
                                        <span> @Model.UserViewModel.Funcao </span>
                                </div>

                                <div class="mt-1">
                                    <!-- Add margin-top for spacing -->
                                    <label for="colFormLabelSm"> Seção:</label>
                                        <span> @Model.UserViewModel.Secao </span>
                                </div>


                            }

                        </div>
                    </div>

                </div>
            </div>


        </div>

    </div>

    <div class="col-md-3">

        <div class="row mb-2">
                <label for="Codigo" class="col-3 col-form-label">Codigo</label>
            <div class="col-sm-7">
                    <input name="Codigo" class="form-control" id="Codigo" oninput="formataCodigoProduto(this, event);" maxlength="14" value="@(Model?.SearchHistoricoModel?.Codigo != null ? Model?.SearchHistoricoModel?.Codigo : "")">
            </div>
        </div>

        <div class="row mb-2">
                <label for="AF" class="col-3 col-form-label">AF/Serial</label>
            <div class="col-7">
                    <input name="AF" class="form-control" id="AF" value="@(Model?.SearchHistoricoModel?.AF != null ? Model?.SearchHistoricoModel?.AF : "")">
            </div>
        </div>

        <div class="row mb-2">
                <label for="PAT" class="col-3 col-form-label"> PAT </label>
            <div class="col-7">
                    <input name="PAT" class="form-control" id="PAT" oninput="SomenteNumeros(this, event);" value="@(Model?.SearchHistoricoModel?.PAT != null ? Model?.SearchHistoricoModel?.PAT : "")">
            </div>
        </div>

        <div class="row mb-2">
                <label for="Catalogo" class="col-3 col-form-label"> Item </label>
            <div class="col-7">
                    <input name="Catalogo" class="form-control" id="Catalogo" value="@(Model?.SearchHistoricoModel?.Catalogo != null ? Model?.SearchHistoricoModel?.Catalogo : "")">
            </div>
        </div>

        <div class="row mb-2">
            <label for="colFormLabelSm" class="col-3 col-form-label"> Catalogo </label>
            <div class="col-7">
                <select name="Classe" class="form-select" aria-label="Small select example">
                    <option> Selecionar... </option>
                    <option value="1"> Ferramentas </option>
                    <option value="2"> EPI </option>
                </select>
            </div>
        </div>

@*        <div class="row mb-2">
                <label for="DataValidade" class="col-3 col-form-label"> Data de Validade </label>
            <div class="col-7">
                    <input name="DataDeValidade" type="date" class="form-control" id="DataValidade">
            </div>
        </div>*@


    </div>

    <div class="col-md-4">

        <div class="row mb-3">
            <label for="colFormLabelSm" class="col-3 col-form-label">Devolvidos</label>
            <div class="col-4">
                    Ferramenta <input class="form-check-input" type="checkbox" value="1" id="flexCheckChecked" name="Ferramenta" checked>
            </div>
            <div class="col-4">
                    EPI <input class="form-check-input" type="checkbox" value="2" name="EPI" id="flexCheckChecked" checked>
            </div>
        </div>

        <div class="row mb-3">
            <label for="colFormLabelSm" class="col-sm-3 col-form-label col-form-label-sm">Consumiveis</label>
            <div class="col-sm-4">
                    <input class="form-check-input" type="checkbox" value="3" name="Consumiveis" id="flexCheckChecked">
            </div>
        </div>

        <div class="row mb-3">
            <label for="colFormLabelSm" class="col-sm-3 col-form-label col-form-label-sm">Emprestados</label>
            <div class="col-sm-5">
                    Ferramentas <input class="form-check-input" type="checkbox" value="1" name="EmprestadoFerramenta" id="flexCheckChecked" checked>
            </div>
            <div class="col-sm-4">
                    EPIS <input class="form-check-input" type="checkbox" value="2" name="EmprestadoEPI" id="flexCheckChecked" checked>
            </div>
        </div>

        <div class="row mb-3">
            <label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Transações</label>
            <div class="col-sm-5">
                    De <input name="TransacoesDe" type="date" class="form-control form-control-sm" id="colFormLabelSm" value="@(Model?.SearchHistoricoModel?.TransacoesDe.HasValue == true ? Model?.SearchHistoricoModel?.TransacoesDe.Value.ToString("yyyy-MM-dd") : "")">
            </div>
            <div class="col-sm-5">
                    Ate <input name="TransacoesAte" type="date" class="form-control form-control-sm" id="colFormLabelSm" value="@(Model?.SearchHistoricoModel?.TransacoesAte.HasValue == true ? Model?.SearchHistoricoModel?.TransacoesAte.Value.ToString("yyyy-MM-dd") : "")">
            </div>
        </div>

        <div class="row mb-3">
            <label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Previsao de Entrega </label>
            <div class="col-sm-5">
                    De <input name="PrevisaoDe" type="date" class="form-control form-control-sm" id="colFormLabelSm" value="@(Model?.SearchHistoricoModel?.PrevisaoDe.HasValue == true ? Model?.SearchHistoricoModel?.PrevisaoDe.Value.ToString("yyyy-MM-dd") : "")">
            </div>
            <div class="col-sm-5">
                    Ate <input name="PrevisaoAte" type="date" class="form-control form-control-sm" id="colFormLabelSm" value="@(Model?.SearchHistoricoModel?.PrevisaoAte.HasValue == true ? Model?.SearchHistoricoModel?.PrevisaoAte.Value.ToString("yyyy-MM-dd") : "")">
            </div>
        </div>

        <div class="row mb-2">
            <label for="colFormLabelSm" class="col-sm-3 col-form-label col-form-label-sm"> Observação </label>
            <div class="col-sm-7">
                    <input name="Observacao" class="form-control form-control-sm" id="colFormLabelSm" value="@(Model?.SearchHistoricoModel?.Observacao != null ? Model?.SearchHistoricoModel?.Observacao : "")">
            </div>
        </div>

        <div class="form-check">
                <input class="form-check-input" type="checkbox" value="true" name="ItensExtraviados" id="flexCheckChecked">
            <label class="form-check-label" for="flexCheckChecked">
                Itens Extraviados.
            </label>
        </div>

    </div>

</div>

<div class="row">
    <div class="col-md-5">
        <div class="row">
            <div class="col-md-8">
                    <button type="submit" class="btn btn-info loadingButton" id="searchButton" style="color: white;">
                    <img src="~/img/search.svg" /> Filtrar
                </button>
            </div>
        </div>
    </div>
</div>

<div>
 </form>

<table class="table table-sm align-left" id="myTable">
    <thead>
        <tr>
            <th>
                Código
            </th>
            <th>
                Produto
            </th>
            <th>
                C.A
            </th>
            <th>
                AF/Serial
            </th>
            <th>
                PAT
            </th>
            <th>
                Ferr. Origem
            </th>
            <th>
                Ferr. Devolução
            </th>
            <th>
                Qtd. Emp.
            </th>
            <th>
                Data Emprestimo
            </th>
            <th>
                Data Prevista Devolução
            </th>
            <th>
                Data da Devolução
            </th>
            <th>
                Obs
            </th>
            <th>
                Liberador
            </th>
            <th>
                Balc. Emp.
            </th>
            <th>
                Balc. Dev.
            </th>
         @*   <th>

            </th>*@
            <th>
                Ficha
            </th>        
        </tr>
    </thead>
    <tbody>
        @if (Model?.HistoricoListModel != null)
        {
            @foreach (var item in Model.HistoricoListModel)
            {
                  <tr>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                            @item.CodigoCatalogo
                      </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                            @item.NomeCatalogo
                      </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                            @item.IdControleCA
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @item.AFProduto
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @item.PATProduto
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @item.FerrOrigem
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @item.FerrDevolucao
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @item.Quantidade
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @if (item.DataEmprestimo.HasValue)
                        {
                           @* @(((DateTime)item.DataEmprestimo).ToString("dd/MM/yyyy"))*@
                            <span>@item.DataEmprestimo.Value.ToString("dd/MM/yyyy HH:mm")</span>
                        }
                        else
                        {
                            <span>---</span>
                        }
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @if (item.DataPrevistaDevolucao.HasValue)
                        {
                            <span>@item.DataPrevistaDevolucao.Value.ToString("dd/MM/yyyy")</span>
                 
                            @*@(((DateTime)item.DataPrevistaDevolucao).ToString("dd/MM/yyyy"))*@
                        }
                        else
                        {
                            <span>---</span>
                        }
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @if (item.DataDevolucao != null && item.DataDevolucao != DateTime.MinValue && item.DataDevolucao != item.DataEmprestimo)
                        {
                            @*@(((DateTime)item.DataDevolucao).ToString("dd/MM/yyyy HH:mm"))*@
                      @*       <span>@item.DataDevolucao.Value.ToString("dd/MM/yyyy HH:mm")</span> *@

                            <a asp-action="PrintTicket" asp-route-id="@item.IdHistoricoAlocacao"> @item.DataDevolucao.Value.ToString("dd/MM/yyyy HH:mm") </a>

                        }
                        else
                        {
                            <span>---</span>
                        }
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @if (!string.IsNullOrEmpty(item.Observacao))
                        {
                           @*<a asp-action="GetObservacao" asp-route-id="@item.IdHistoricoAlocacao"> <img src="~/img/chat-dots.svg" /> </a>*@

                            <a data-bs-toggle="popoverdd" data-bs-placement="right"
                               data-bs-title="Observacao"
                               data-bs-trigger="hover"
                               data-bs-content="@item.Observacao"> <img src="~/img/chat-dots.svg" /> </a>
                        }
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @if (!string.IsNullOrEmpty(item.Liberador_Chapa))
                        {
                            <a asp-action="GetLiberador" asp-route-id="@item.Liberador_Chapa"> @item.Liberador_Chapa </a>
                        }
                        else
                        {
                            <span>---</span>
                        }
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @if (!string.IsNullOrEmpty(item.Balconista_EmprestimoChapa))
                        {
                            <a asp-action="GetBalconistaEmp" asp-route-id="@item.Balconista_EmprestimoChapa"> @item.Balconista_EmprestimoChapa </a>
                        }
                        else
                        {
                            <span>---</span>
                        }
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @if (!string.IsNullOrEmpty(item.Balconista_DevolucaoChapa))
                        {
                            <a asp-action="GetBalconistaDev" asp-route-id="@item.Balconista_DevolucaoChapa"> @item.Balconista_DevolucaoChapa </a>
                        }
                        else
                        {
                            <span>---</span>
                        }
                    </td>
                    <td style="@(item.QuantidadeExtraviada != 0 ? "background-color: #FF3048;" : "")">
                        @if (item.UploadedFile == 1)
                        {
                            <a asp-action="OpenSingleUpload" asp-route-idHistorico="@item.IdHistoricoAlocacao" asp-route-idProdutoAlocado="@item.IdProdutoAlocado" asp-route-YearDevolucao="@(item.DataDevolucao.HasValue ? item.DataDevolucao.Value.Year : null)">
                                <img src="~/img/file-arrow-up-fill.svg" />
                            </a>
                        }
                        else
                        {
                            <a asp-action="OpenSingleUpload" asp-route-idHistorico="@item.IdHistoricoAlocacao" asp-route-idProdutoAlocado="@item.IdProdutoAlocado" asp-route-YearDevolucao="@(item.DataDevolucao.HasValue ? item.DataDevolucao.Value.Year : null)">
                                <img src="~/img/file-arrow-up.svg" />
                            </a>
                        }                  
                    </td>
                  </tr>
            }
        }
        else
        {
            
        }
    </tbody>
</table>

</div>

<form asp-action="ExportToExcel" method="post">
    @if (Model?.HistoricoListModel != null && Model?.HistoricoListModel.Count() > 0)
    {
        <div class="row mb-4">
            <div class="col-sm-12 d-flex justify-content-end">

                <button type="submit" class="btn btn-info" style="color: white;">
                    Exportar
                </button>

            </div>
        </div>
    }
</form>

@if (ViewBag.Messages != null)
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var modal = document.getElementById('ListOfMessages');
            var modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        });
    </script>
}

@if (ViewBag.ListOfEmployees != null)
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var modal = document.getElementById('ListOfUsers');
            var modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        });
    </script>
}

@if (ViewBag.OpenObsModal != null && (bool)ViewBag.OpenObsModal)
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var modal = document.getElementById('obsModal');
            var modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        });
    </script>
}

@if (ViewBag.OpenLiberadorModal != null && (bool)ViewBag.OpenLiberadorModal)
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var modal = document.getElementById('LiberadorModal');
            var modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        });
    </script>
}

@if (ViewBag.OpenBalconistaEmpModal != null && (bool)ViewBag.OpenBalconistaEmpModal)
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var modal = document.getElementById('BalconistaEmpModal');
            var modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        });
    </script>
}

@if (ViewBag.OpenBalconistaDevModal != null && (bool)ViewBag.OpenBalconistaDevModal)
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var modal = document.getElementById('BalconistaDevModal');
            var modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        });
    </script>
}

@if (ViewBag.OpenSingle != null && (bool)ViewBag.OpenSingle)
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var modal = document.getElementById('uploadModal');
            var modalInstance = new bootstrap.Modal(modal);
            modalInstance.show();
        });
    </script>
}

<script>
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popoverdd"]'))
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl)
    })
</script>

@if (ViewBag.ReceiptHtml != null)
{
    <script type="text/javascript">
        console.log("open");

        // Escape the HTML content before passing it to the JavaScript
        var receiptHtml = '@Html.Raw(HttpUtility.JavaScriptStringEncode(ViewBag.ReceiptHtml))';

        // Automatically open and print the receipt after the view loads
        openReceiptWindow(receiptHtml);

        function openReceiptWindow(receiptHtml) {
            console.log("Receipt Window Opening...");

            // Open a new window
            var receiptWindow = window.open('', '_blank', 'width=400,height=600');

            // Write the receipt content to the new window
            receiptWindow.document.write(receiptHtml);

            // Close the document to finish rendering
            receiptWindow.document.close();

            // Automatically trigger the print dialog
            receiptWindow.print();
        }
    </script>
}